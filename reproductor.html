<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reproductor</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 50%, #0c0c0c 100%);
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          overflow: hidden;
          position: relative;
      }

      /* Patr칩n de fondo sutil */
      body::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-image: 
              radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.02) 0%, transparent 50%),
              radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.02) 0%, transparent 50%);
          pointer-events: none;
          z-index: 1;
      }

      #container {
          position: relative;
          width: 100vw;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2;
      }

      #video {
          width: 100%;
          height: 100%;
          object-fit: contain;
          display: none;
          border-radius: 0;
          box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
      }

      /* Loader Moderno */
      #loader {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
          color: white;
          z-index: 10;
      }

      .loader-container {
          background: rgba(0, 0, 0, 0.8);
          backdrop-filter: blur(10px);
          border-radius: 20px;
          padding: 40px 50px;
          border: 1px solid rgba(255, 255, 255, 0.1);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .spinner {
          width: 60px;
          height: 60px;
          border: 3px solid rgba(255, 255, 255, 0.1);
          border-top: 3px solid #00d4ff;
          border-right: 3px solid #ff6b6b;
          border-radius: 50%;
          animation: spin 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
          margin: 0 auto 25px;
          position: relative;
      }

      .spinner::after {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          width: 30px;
          height: 30px;
          border: 2px solid rgba(255, 255, 255, 0.2);
          border-top: 2px solid #4ecdc4;
          border-radius: 50%;
          transform: translate(-50%, -50%);
          animation: spin-reverse 0.8s linear infinite;
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }

      @keyframes spin-reverse {
          0% { transform: translate(-50%, -50%) rotate(360deg); }
          100% { transform: translate(-50%, -50%) rotate(0deg); }
      }

      .loading-text {
          font-size: 18px;
          font-weight: 300;
          color: #ffffff;
          margin-bottom: 10px;
          letter-spacing: 1px;
      }

      .loading-subtitle {
          font-size: 14px;
          color: #888;
          font-weight: 300;
      }

      /* Puntos animados */
      .dots {
          display: inline-block;
      }

      .dots::after {
          content: '';
          animation: dots 1.5s steps(4, end) infinite;
      }

      @keyframes dots {
          0%, 20% { content: ''; }
          40% { content: '.'; }
          60% { content: '..'; }
          80%, 100% { content: '...'; }
      }

      /* Error Moderno */
      #error {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
          display: none;
          z-index: 10;
      }

      .error-container {
          background: rgba(20, 20, 20, 0.9);
          backdrop-filter: blur(15px);
          border-radius: 20px;
          padding: 40px 50px;
          border: 1px solid rgba(255, 68, 68, 0.3);
          box-shadow: 0 20px 40px rgba(255, 68, 68, 0.1);
      }

      .error-icon {
          font-size: 64px;
          margin-bottom: 20px;
          animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
          0%, 100% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.1); opacity: 0.8; }
      }

      .error-text {
          font-size: 18px;
          color: #ff6b6b;
          font-weight: 300;
          margin-bottom: 10px;
          letter-spacing: 0.5px;
      }

      .error-subtitle {
          font-size: 14px;
          color: #999;
          font-weight: 300;
      }

      /* Efectos de entrada */
      .fade-in {
          animation: fadeIn 0.6s ease-out;
      }

      @keyframes fadeIn {
          from { 
              opacity: 0; 
              transform: translate(-50%, -50%) scale(0.9);
          }
          to { 
              opacity: 1; 
              transform: translate(-50%, -50%) scale(1);
          }
      }

      /* Responsive */
      @media (max-width: 768px) {
          .loader-container,
          .error-container {
              padding: 30px 35px;
              margin: 0 20px;
          }
          
          .loading-text,
          .error-text {
              font-size: 16px;
          }
          
          .spinner {
              width: 50px;
              height: 50px;
          }
          
          .error-icon {
              font-size: 48px;
          }
      }

      /* Video fade in */
      .video-fade-in {
          animation: videoFadeIn 0.8s ease-out;
      }

      @keyframes videoFadeIn {
          from { 
              opacity: 0;
              transform: scale(0.95);
          }
          to { 
              opacity: 1;
              transform: scale(1);
          }
      }
  </style>
</head>
<body>
  <div id="container">
      <!-- Loader Moderno -->
      <div id="loader" class="fade-in">
          <div class="loader-container">
              <div class="spinner"></div>
              <div class="loading-text">Cargando canal<span class="dots"></span></div>
              <div class="loading-subtitle">Preparando transmisi칩n</div>
          </div>
      </div>

      <!-- Error Moderno -->
      <div id="error">
          <div class="error-container fade-in">
              <div class="error-icon">游뛂</div>
              <div class="error-text">Error al cargar el canal</div>
              <div class="error-subtitle">Verifica tu conexi칩n e intenta nuevamente</div>
          </div>
      </div>

      <!-- Video -->
      <video id="video" controls autoplay muted></video>
  </div>

  <script>
      class StreamPlayer {
          constructor() {
              this.video = document.getElementById('video');
              this.loader = document.getElementById('loader');
              this.error = document.getElementById('error');
              this.hls = null;
              this.maxRetries = 3;
              this.retryCount = 0;
              this.retryDelay = 2000;
              
              this.init();
          }

          init() {
              const urlParams = new URLSearchParams(window.location.search);
              const iframe = urlParams.get('iframe');
              const stream = urlParams.get('stream');

              if (iframe) {
                  this.loadFromIframe(iframe);
              } else if (stream) {
                  this.loadFromStream(stream);
              } else {
                  this.showError();
              }
          }

          async loadFromIframe(iframe) {
              try {
                  const response = await fetch(`extractor.php?iframe=${encodeURIComponent(iframe)}`);
                  const data = await response.json();

                  if (data.success && data.url) {
                      this.loadVideo(data.url);
                  } else {
                      if (this.retryCount < this.maxRetries) {
                          this.retryCount++;
                          setTimeout(() => this.loadFromIframe(iframe), this.retryDelay);
                      } else {
                          this.showError();
                      }
                  }
              } catch (error) {
                  if (this.retryCount < this.maxRetries) {
                      this.retryCount++;
                      setTimeout(() => this.loadFromIframe(iframe), this.retryDelay);
                  } else {
                      this.showError();
                  }
              }
          }

          async loadFromStream(stream) {
              try {
                  const response = await fetch(`extractor.php?stream=${encodeURIComponent(stream)}`);
                  const data = await response.json();

                  if (data.success && data.url) {
                      this.loadVideo(data.url);
                  } else {
                      if (this.retryCount < this.maxRetries) {
                          this.retryCount++;
                          setTimeout(() => this.loadFromStream(stream), this.retryDelay);
                      } else {
                          this.showError();
                      }
                  }
              } catch (error) {
                  if (this.retryCount < this.maxRetries) {
                      this.retryCount++;
                      setTimeout(() => this.loadFromStream(stream), this.retryDelay);
                  } else {
                      this.showError();
                  }
              }
          }

          loadVideo(m3u8Url) {
              if (Hls.isSupported()) {
                  this.hls = new Hls({
                      enableWorker: true,
                      lowLatencyMode: true,
                      backBufferLength: 90
                  });

                  this.hls.loadSource(`proxy.php?url=${encodeURIComponent(m3u8Url)}`);
                  this.hls.attachMedia(this.video);

                  this.hls.on(Hls.Events.MANIFEST_PARSED, () => {
                      this.hideLoader();
                      this.showVideo();
                      this.video.play().catch(() => {
                          // Silencioso si falla el autoplay
                      });
                  });

                  this.hls.on(Hls.Events.ERROR, (event, data) => {
                      if (data.fatal) {
                          this.showError();
                      }
                  });

              } else if (this.video.canPlayType('application/vnd.apple.mpegurl')) {
                  this.video.src = `proxy.php?url=${encodeURIComponent(m3u8Url)}`;
                  this.video.addEventListener('loadedmetadata', () => {
                      this.hideLoader();
                      this.showVideo();
                  });
                  this.video.addEventListener('error', () => {
                      this.showError();
                  });
              } else {
                  this.showError();
              }
          }

          showVideo() {
              this.video.style.display = 'block';
              this.video.classList.add('video-fade-in');
          }

          hideLoader() {
              this.loader.style.opacity = '0';
              this.loader.style.transform = 'translate(-50%, -50%) scale(0.9)';
              setTimeout(() => {
                  this.loader.style.display = 'none';
              }, 300);
          }

          showError() {
              this.loader.style.display = 'none';
              this.error.style.display = 'block';
          }
      }

      // Inicializar cuando cargue la p치gina
      document.addEventListener('DOMContentLoaded', () => {
          new StreamPlayer();
      });
  </script>
</body>
<!-- MODO -->
<script disable-devtool-auto src='https://cdn.jsdelivr.net/npm/disable-devtool'></script>

</html>
